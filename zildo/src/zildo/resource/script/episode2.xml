<adventure>

    <quest name="fuite_tony1">
        <trigger>
            <location name="promenade"/>
            <questDone name="trig_echange"/>
        </trigger>
        <action>
            <speak who="zildo" text="promenade.fuite.zildo"/>
            <moveTo who="tony" pos="0,-12" delta="true"/>
            <angle who="tony" value="2"/>
            <wait value="20"/>
            <moveTo who="tony" pos="0,-100" delta="true"/>
            <remove who="tony"/>
            <script who="bunny" value="8"/>
        </action>
    </quest>

    <quest name="vert_seen">
    	<trigger>
    	    <location name="voleurs" pos="612,830" radius="2"/>
    	</trigger>
    	<action>
    	    <moveTo who="vert" pos="-30,0" delta="true"/>
    	    <moveTo who="vert" pos="-2,-60" delta="true" unblock="true"/>
    	    <!-- Put knives -->
    	    <tile pos="55,32" back2="1277"/>
    	    <tile pos="56,32" back2="1277"/>
    	    <tile pos="57,32" back2="1277"/>
    	</action>    
    </quest>
    
    <quest name="vg5_but1" repeat="true" locked="false">
    	<trigger>
    	    <location name="voleursg5" tilePos="52,26" gear="TIMED_BUTTON"/>
    	</trigger>
    	<action>
    	    <exec script="move_vg5_plat1"/>
    	</action>
    </quest>

    <quest name="vg5_but2" repeat="true" locked="false">
    	<trigger>
    	    <location name="voleursg5" tilePos="25,26" gear="TIMED_BUTTON"/>
    	</trigger>
    	<action>
    	    <exec script="move_vg5_plat2"/>
    	</action>
    </quest>
    
    <quest name="vg5_back" repeat="true" locked="false">
	    <trigger>
	        <location name="voleursg5" mover="platform2"/>
	        <questDone name="!move_vg5_plat2"/>
	    </trigger>
	    <action>
	        <exec script="move_vg5_plat2"/>
	    </action>
    </quest>
    
    <!--  Just to set hero on foreground from this location -->
    <quest name="zcave_foreground" repeat="true" locked="false">
    	<trigger><location name="voleursg5" pos="615,485" radius="2"/></trigger>
    	<action><pos who="zildo" foreground="true"/></action>
    </quest>
    
    <quest name="attaque_voleurs">
        <trigger>
            <location name="voleurs" pos="877,989" radius="1"/>
        </trigger>
        <action>
            <exec script="attaqueV"/>
        </action>
    </quest>
    
    <quest name="squeaky_floor_voleurs" repeat="true" locked="false">
        <trigger>	<!-- 2*256 + 57 = 569 --> 
            <location name="voleursm1" tileValue="569"/>
        </trigger>
        <action>
            <exec script="disturbVoleurs"/>
        </action>
    </quest>
    
    <quest name="squeaky_floor_voleurs2" repeat="true" locked="false">
        <trigger>
            <location name="voleursm2" tileValue="569"/>
        </trigger>
        <action>
            <exec script="disturbVoleurs"/>
        </action>
    </quest>
    
    <mapScript>
	    <!--  , means OR  -->
	    <!--  - means AND -->        
	    <condition name="promenade" exp="trig_echange-!fuite_tony1">
	    	<spawn type="BANDIT_VERT" speed="1.3" pos="935,369" angle="0" who="tony"/>
	    	<script who="bunny" value="3"/>
	    </condition>
	    <condition name="voleurs" exp="!vol">
	        <pos who="vert" pos="32,0" foreground="true" delta="true"/>
	    </condition>
   		<condition name="voleurs" exp="!fini_voleur">
			<filter type="1"/>
			<!-- Post guard -->
    	    <spawn type="FOX" who="fox1" effect="rouge" pos="870,878"/>
    	    <spawn type="FOX" who="fox2" effect="violet" pos="1039,922"/>			
		</condition>
		<condition name="voleursm1" exp="!fini_voleur">
			<filter type="1"/>
		</condition>
		<condition name="voleursm2" exp="!fini_voleur">
			<filter type="1"/>
		</condition>
		<condition name="voleursg3" exp="trig_echange">
		    <actions>
		    	<animation type="BIG_FIREBALL" what="fireb1" angle="0" pos="144,302"/>
		    	<animation type="BIG_FIREBALL" what="fireb2" angle="0" pos="224,302"/>
		    </actions>
		    <wait value="20"/>
		    <actions>
			   	<animation type="BIG_FIREBALL" what="fireb3" angle="3" pos="320,131"/>
			    <animation type="BIG_FIREBALL" what="fireb4" angle="3" pos="320,211"/>
		    </actions>
   		</condition>
   		<condition name="voleursg6" exp="trig_echange">
		    <actions>
		    	<animation type="BIG_FIREBALL" what="fireb1" angle="0" pos="144,302"/>
		    	<animation type="BIG_FIREBALL" what="fireb2" angle="0" pos="224,302"/>
		    </actions>
		    <wait value="30"/>
		    <actions>
			   	<animation type="BIG_FIREBALL" what="fireb3" angle="1" pos="29,131"/>
			    <animation type="BIG_FIREBALL" what="fireb4" angle="1" pos="29,211"/>
		    </actions>
   		</condition>
   		<condition name="prisonext" exp="trig_echange">
   		    <perso who="gardenord" type="GARDE_CANARD" effect="GUARD_BLACK"/>
   		    <perso who="gard2" type="GARDE_CANARD" effect="noir" info="ENEMY"/>
   		    <perso who="gard3" type="GARDE_CANARD" effect="noir" info="ENEMY"/>
   		    <perso who="gard4" type="GARDE_CANARD" effect="noir" info="ENEMY"/>
   		    <perso who="gard5" type="GARDE_CANARD" effect="noir" info="ENEMY"/>
   		    <script who="gardenord" value="3"/>
   		    <script who="gard2" value="3"/>
   		    <script who="gard3" value="3"/>
   		    <script who="gard4" value="3"/>
   		    <script who="gard5" value="3"/>
		</condition>
		<condition name="voleursm1">
		    <perso who="rouge" action="sleeping"/>
		    <perso who="violet" action="sleeping"/>
		</condition>
		<condition name="voleursm2">
		    <perso who="vert" action="sleeping"/>
		</condition>
	</mapScript>

	<scene id="intro_episode2">
		<fadeOut type="0"/>
		<!--  Preambule => remove for release -->
		<map name="promenade2"/>
	    <pos who="zildo" pos="561,193"/>
	    <spawn who="emissaire" pos="455,250" effect="jaune" type="GARDE_CANARD" angle="3"/>
	    <spawn who="tony" type="BANDIT_VERT" pos="455,220" angle="3"/>
		<focus who="emissaire"/>
	    <fadeIn type="1"/>
	    <!--  Real scene -->
	    <moveTo who="tony" pos="32,2" delta="true" unstoppable="true" speed="2"/>
	    <actions>
		    <angle who="emissaire" value="1"/>
		    <angle who="zildo" value="2"/>
		    <speak who="emissaire" text="echange.ep2.emissaire1"/>
		    <moveTo who="tony" pos="96,96" delta="true" unstoppable="true" />
	    </actions>
   	    <actions>
   	    	<moveTo who="tony" pos="60,0" delta="true" unstoppable="true" />
   	       	<moveTo who="emissaire" pos="4,6" delta="true"/>
   	    </actions>
	    <remove who="tony"/>
	    <moveTo who="zildo" pos="0,8" delta="true"/>
	    <wait value="10"/>
	    <moveTo who="emissaire" pos="-8,2" delta="true"/>
	    <wait value="10"/>
	    <moveTo who="emissaire" pos="2,0" delta="true"/>
	    <wait value="20"/>
	    <speak who="emissaire" text="echange.ep2.emissaire"/>
	    <actions>
	        <moveTo who="zildo" pos="-8,4" delta="true"/>
			<speak who="zildo" text="echange.ep2.zildo"/>
	    </actions>
		<speak who="emissaire" text="echange.ep2.emissaire2"/>
		<actions>
		    <focus who="zildo" delta="true"/>
		    <moveTo who="emissaire" pos="-42,2" delta="true" speed="0.5"/>
		</actions>
	</scene>
	
	<scene id="attaqueV">
	    <speak who="fox1" text="voleurs.fox1" unblock="true"/>
	    <actions>
            <moveTo who="fox1" pos="-32,4" delta="true" unstoppable="true" speed="1.5"/>
            <moveTo who="fox2" pos="-68,8" delta="true" unstoppable="true" speed="1.5"/>
            <angle who="zildo" value="1"/>
	    </actions>
	    <actions>
        	<moveTo who="fox1" pos="0,100" delta="true"/>
			<moveTo who="fox2" pos="913,998"/>
			<moveTo who="zildo" pos="890,1005" speed="0.5"/>     
	    </actions>
	    <pos who="vert" pos="713,764"/>
	    <angle who="fox2" value="3"/>
	    <moveTo who="fox1" pos="870,980"/>
	    <angle who="fox1" value="2"/>
	    <angle who="zildo" value="0"/>
	    <speak who="fox2" text="voleurs.fox2"/>
	    <angle who="zildo" value="2"/>
	    <moveTo who="fox1" pos="872,982" unblock="true"/>
	    <speak who="fox1" text="voleurs.fox3"/>
	    <moveTo who="fox2" pos="910,998" unblock="true"/>
	    <angle who="zildo" value="1"/>
	    <moveTo who="vert" pos="807,906" unblock="true"/>
	    <speak who="fox2" text="voleurs.fox4"/>
	    <actions>
	        <moveTo who="fox2" pos="900,998"/>
	        <moveTo who="zildo" pos="880,1005" backward="true"/>
	    </actions>
   	    <speak who="fox2" text="voleurs.fox5"/>
   	    <moveTo who="fox1" pos="874,985" unblock="true"/>
   	    <speak who="fox2" text="voleurs.fox6"/>
   	    <actions>
   	    	<moveTo who="fox2" pos="889,1005"/>
   	    	<moveTo who="zildo" pos="875,1005" backward="true"/>
   	    </actions>
   	    <var name="moneyStolen" value="zildo.money"/>
   	    <take value="-999"/>
   	    <speak who="fox2" text="voleurs.fox7"/>
   	    <actions>
   	    	<moveTo who="fox2" pos="-20,0" delta="true" speed="1.5"/>
   	    	<moveTo who="zildo" pos="-25,0" delta="true" backward="true" speed="1.5"/>
	   	    <speak who="fox2" text="voleurs.fox8"/>
	   	    <moveTo who="vert" pos="839,924"/>
   	    </actions>
   	    <angle who="fox1" value="3"/>
   	    <angle who="vert" value="2"/>
   	    <attack who="vert"/>
   	    <wait value="10"/>
   	    <angle who="zildo" value="0"/>
   	   	<wait value="5"/>
   	    <moveTo who="zildo" pos="-32,0" delta="true"/>
   	    <angle who="zildo" value="1"/>
   	</scene>
   	
	<scene id="move_vg5_plat1">
	    <moveTo what="platform" pos="-220,0" delta="true" speed="2"/>
	    <wait value="30"/>
	    <moveTo what="platform" pos="220,0" delta="true" speed="2"/>
	    <wait value="10"/>
	</scene>
	<scene id="move_vg5_plat2">
	    <moveTo what="platform2" pos="0,128" delta="true" speed="2"/>
	    <wait value="100"/>
	    <moveTo what="platform2" pos="0,-128" delta="true" speed="2"/>
	    <wait value="10"/>
	</scene>
	
	<scene id="disturbVoleurs">
		<lookFor who="zildo" radius="8" info="ENEMY">
            <wait value="4"/>
            <sound name="ZildoLance"/> 
            <script who="self" text="BRAS_LEVES"/>
		    <throw who="self" pos="x+7, y+4" to="zildo.x+random*12-6,zildo.y+random*12-6" speed="1.6"
       		 	   type="ROCK_BALL" shadow="SHADOW_MINUS" z="16" az="-0.08" way="BELL"/>
		    <wait value="20"/>
		    <script who="self" text="VIDE"/>
		</lookFor>
		<wait value="50"/>
	</scene>

	<persoAction id="sleeping">
	    <timer each="40+20*random">
	        <action>
		        <spawn type="dice10>4:ZZZ1,ZZZ2"
		               pos="x, y" z="4"
		               vx="0.1" vz="0.1"
		               foreground="true"
		               alphaA="-0.1"/>
	        </action>
	    </timer>
	</persoAction>
</adventure>