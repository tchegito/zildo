<adventure>
    
   	<mapScript>
   	<!--
	    <condition name="sousbois3" locked="false">
	    	<spawn who="bitey" pos="220,118" type="BITEY"/>
	    	<perso who="bitey" action="bitey"/> 
   	    </condition>
    -->
	    <condition name="canyon" locked="false">
	    	<spawn who="bitey" pos="699,187" type="BITEY" info="ENEMY"/>
	    	<perso who="bitey" action="bitey"/>
	    	<!-- Place catapult TODO: plan quest to set each catapult state -->
	    	<spawn what="catcrate1" pos="551,280" type="CATAPULT_CRATE"/>
	    	<spawn what="catbranch1" pos="551,280" reverse="128" z="3" type="CATAPULT_BRANCH"/>
	    	<spawn what="stone1" pos="566,281" type="STONE_HEAVY"/>
	    	
	    	<spawn what="catcrate2" pos="738,263" type="CATAPULT_CRATE"/>
	    	<spawn what="catbranch2" pos="738,263" reverse="128" z="3" type="CATAPULT_BRANCH"/>
	    	<spawn what="stone2" pos="753,264" type="STONE"/>
	    	
	    	<markQuest name="catap1" value="false"/>
	    	<markQuest name="catap2" value="false"/>
	    </condition> 
   	</mapScript>
    
   	<!-- 743,254 -->
   	
   	<quest name="catap1" locked="false">
   	    <trigger>
   	        <location name="canyon" pos="452,338" radius="2"/>
   	    </trigger>
   	    <action>
   	        <exec script="vultureCatap(520, 184, 566-25, 281-8, 'stone1', 'catbranch1')"/>
   	    </action>
   	</quest>
   	
   	<quest name="catap2" locked="false">
   	    <trigger>
   	        <location name="canyon" pos="704,339" radius="2"/>
   	    </trigger>
   	    <action>
   	        <exec script="vultureCatap(710, 164, 753-25, 264-8, 'stone2', 'catbranch2')"/>
   	    </action>
   	</quest>
   	
    <persoAction id="bitey">
        <loop>
            <var name="loc:found" value="0"/>
			<lookFor who="self" info="ZILDO" radius="7">
				<var name="loc:found" value="1"/>
			</lookFor>
			<actions>
				<if exp="loc:found=1">
				    <!-- Set angle and reverse -->
				    <actions>
					    <if exp="zildo.x &gt; x">
						    <perso who="self" reverse="128"/>
						    <angle who="self" value="1"/>
					    </if>
					    <if exp="zildo.x &lt; x">
						    <perso who="self" reverse="0"/>
						    <angle who="self" value="3"/>
					    </if>
				    </actions>
				    <!-- "Idle near" animation and bite if character is really close -->
		            <!-- Idle near -->
		            <seq who="self" addSpr="1,2,3,4,5,6,0,1,2" wait="4"/>
		            <sound name="Wind"/>
		            <!-- Extension to the victim -->
	            	<seq who="self" addSpr="11,12,13,14,15,16,17,18,19,20,21" wait="1"/>
	            	<actions>
		            	<if exp="angle=1">
							<spawn impact="GNAP" pos="x+55,y+4" reverse="128"/>	
		            	</if>
		            	<if exp="angle=3">
							<spawn impact="GNAP" pos="x-55,y+4"/>
						</if>
					</actions>	
	            	<sound name="Wind" mute="true"/>
	            	<sound name="Bitey"/>		    	
	            	<!-- Back to origin -->				    
	            	<seq who="self" addSpr="22,23,24,25,26,27" wait="1"/>
	            	<perso who="self" addSpr="28"/>
				</if>
				<if exp="loc:found=0">
			        <!-- Idle far -->
					<seq who="self" addSpr="7,8,9,10,9,8" wait="10"/>
				</if>
			</actions>
				        
        </loop>
   	</persoAction>
   	
    <scene id="vultureCatap">
        <!-- (arg0,arg1) origin of vulture -->
        <!-- (arg2,arg3) locatin of the vulture target -->
        <!-- arg4: stone ; arg5: branch -->
		<spawn who="loc:vulture" pos="loc:arg0,loc:arg1" type="VAUTOUR" info="ENEMY"/>
		<script who="loc:vulture" value="21" />
		<moveTo who="loc:vulture" z="30" pos="loc:arg2,loc:arg3"/>
		<wait value="10"/>
		<!-- 
		<moveTo what="loc:arg4" pos="0,0" delta="true" unstoppable="true"/>
		-->
       	<moveTo who="loc:vulture" speed="3" z="6"/>
       	<actions>
			<sprite what="loc:arg4" vy="1" vx="0.2+random*0.1" az="-0.08" vz="2.8" z="4"/>   	       	    
	       	<sprite what="loc:arg5" reverse="0"/>
       	</actions>
       	<moveTo who="loc:vulture" speed="1.5" z="0"/>
       	<wait value="5"/>
       	<moveTo who="loc:vulture" pos="loc:arg0,loc:arg1" z="20" unblock="true"/>
       	<sprite what="loc:arg4" reverse="64"/>
       	<wait value="20"/>
       	<sprite what="loc:arg4" reverse="0"/>
       	<wait value="20"/>
       	<remove who="loc:vulture"/>
    </scene>
</adventure>
