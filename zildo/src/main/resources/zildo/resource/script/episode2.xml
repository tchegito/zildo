<adventure>

    <quest name="promenade2_flut1" repeat="true" locked="false">
        <trigger>
            <location name="promenade2" pos="422,230" radius="2"/>
            <use item="flut"/>
        </trigger>
        <action>
            <wait value="80"/>
            <music name=""/>
            <sound name="Sort"/>
            <wait value="5"/>
            <animation what="stars" type="STAR_TRAIL" pos="388,263"/>
            <moveTo what="stars" pos="64,-10" delta="true" speed="1"/>
            <script who="zildo" value="2" effect="stars"/>
            <speak what="camera" text="promenade2.stars.0" unblock="true"/>
            <moveTo what="stars" pos="40,-10" delta="true" speed="0.8"/>
            <moveTo what="stars" pos="-15,40" delta="true" speed="0.6"/>
            <moveTo what="stars" pos="-60,-40" delta="true" speed="0.5"/>
            <moveTo what="stars" pos="-30,-30" delta="true" speed="0.4"/>

            <speak what="camera" text="promenade2.stars.1" unblock="true"/>
            
            <moveTo what="stars" pos="40,-50" delta="true" speed="0.5"/>
            <moveTo what="stars" pos="-30,-50" delta="true" speed="1"/>
            <moveTo what="stars" pos="20,-80" delta="true" speed="1.5"/>
            
            <wait value="20"/>
            <remove what="stars"/>
            <script who="zildo" value="0"/>
            <music name="Nuit"/>
            
            <markQuest name="promenade_flute_once" value="true"/>
        </action>
    </quest>
    
    <quest name="fuite_tony1">
        <trigger>
            <location name="promenade"/>
            <questDone name="trig_echange"/>
        </trigger>
        <action>
            <speak who="zildo" text="promenade.fuite.zildo"/>
            <moveTo who="tony" pos="0,-12" delta="true"/>
            <angle who="tony" value="2"/>
            <wait value="20"/>
            <moveTo who="tony" pos="0,-100" delta="true"/>
            <remove who="tony"/>
            <script who="bunny" value="8"/>
        </action>
    </quest>

    <quest name="vert_seen">
    	<trigger>
    	    <location name="voleurs" pos="600,812" radius="2"/>
    	</trigger>
    	<action>
    	    <if expQuest="P#vert">
	    	    <moveTo who="vert" pos="-30,0" delta="true"/>
	    	    <moveTo who="vert" pos="-2,-60" delta="true" unblock="true"/>
    	    </if>
    	</action>    
    </quest>
    
    <quest name="vg5_but1" repeat="true" locked="false">
    	<trigger>
    	    <location name="voleursg5" tilePos="52,26" gear="TIMED_BUTTON"/>
    	</trigger>
    	<action>
    	    <exec script="move_vg5_plat1"/>
    	</action>
    </quest>

    <quest name="vg5_but2" repeat="true" locked="false">
    	<trigger>
    	    <location name="voleursg5" tilePos="25,26" gear="TIMED_BUTTON"/>
    	</trigger>
    	<action>
    	    <exec script="move_vg5_plat2"/>
    	</action>
    </quest>
    
    <quest name="vg5_back" repeat="true" locked="false">
	    <trigger>
	        <location name="voleursg5" mover="platform2"/>
	        <questDone name="!move_vg5_plat2"/>
	    </trigger>
	    <action>
	        <exec script="move_vg5_plat2"/>
	    </action>
    </quest>

    <quest name="attaque_voleurs">
        <trigger>
            <location name="voleurs" pos="877,989" radius="1"/>
        </trigger>
        <action>
            <exec script="attaqueV"/>
        </action>
    </quest>
    
    <quest name="beanCaveFlames">
        <trigger>
            <location name="voleursg1"/>
        </trigger>
    </quest>

    <quest name="meanwhile_voleurs">
        <trigger>
            <location name="voleursg3"/>
        </trigger>
        <action>
       	    <exec script="backupGame"/>
            <exec script="voleurs_discutent"/>
            <map name="voleursg3"/>
			<focus who="zildo" />
			<fadeIn type="0"/>
        </action>
    </quest>
    
    <quest name="squeaky_floor_voleurs" repeat="true" locked="false">
        <trigger>	<!-- 2*256 + 57 = 569 --> 
            <location name="voleursm1" tileValue="569"/>
        </trigger>
        <action>
            <exec script="disturbVoleurs"/>
        </action>
    </quest>
    
    <quest name="squeaky_floor_voleurs2" repeat="true" locked="false">
        <trigger>
            <location name="voleursm2" tileValue="569"/>
        </trigger>
        <action>
            <exec script="disturbVoleurs"/>
        </action>
    </quest>
    
    <quest name="voleursm2u(4, 3)">
    	<action>
    	    <speak who="zildo" text="voleurs.m2u.money"/>
    	</action>
    </quest>
    
    <quest name="voleursm4(13, 3)">
    	<action>
    	    <speak who="zildo" text="voleurs.m2u.sword"/>
    	</action>
    </quest>
    
    <quest name="trig_falcor">
        <trigger>
            <questDone name="voleursm4(13, 3)"/>
            <location name="voleursm4" pos="215,64" radius="2"/>
        </trigger>
        <action>
    	    <exec script="falcor_arrive"/>
        </action>
        <history>
			<nameReplace who="falcor" name="falcor"/>
        </history>
    </quest>
    
    <quest name="v3_crate" locked="false">
        <trigger>
            <location name="voleursm3"/>
            <push name="crate" angle="1"/>
            <questDone name="!voleursm3(8,8)"/>
        </trigger>
        <action>
            <animation pos="136,136" type="CLOUD_FOG" />
            <sound name="ChestAppears"/>
            <wait value="2"/>
            <tile pos="8,8" back2="231+256*2"/>
        </action>
    </quest>
    
    <quest name="voleursm4_hiddenbutton" locked="false">
        <trigger>
            <lift name="voleursm4b" tilePos="3,11"/>
        </trigger>
        <action>
            <sound name="ZildoSecret"/>
        </action>
    </quest>
    
    <quest name="voleursm4_button" locked="false">
	    <trigger>
	        <location name="voleursm4b" tilePos="3,11" gear="BUTTON"/>
	    </trigger>
	</quest>
    <!-- 420,282 -->
    <quest name="lily" repeat="true" locked="false">
		<trigger>
	    	<location name="igorlily|igorvillage" mover="leaf"/>
	    	<use item="sword"/>
	    </trigger>
	    <action>
	        <exec script="moveLeaf"/>
	    </action>
	</quest>
    <quest name="lilyMidSword" repeat="true" locked="false">
		<trigger>
	    	<location name="igorlily|igorvillage" mover="leaf"/>
	    	<use item="midsword"/>
	    </trigger>
	    <action>
	        <exec script="moveLeaf"/>
	    </action>
	</quest>
	
    <quest name="summonLeafVillage" locked="false">
        <trigger>
            <location name="igorvillage" pos="420,282" radius="5"/>
            <use item="flut"/>
        </trigger>
        <action>
            <wait value="80"/>
            <spawn what="leaf" type="WATER_LEAF" pos="170,382"/>
            <sound name="SlipWater1"/>
            <moveTo what="leaf" pos="407,386"/>
            <sound name="SlipWater2"/>
            <!-- 415,351 -->
            <moveTo what="leaf" way="physic" pos="1,-1" speed="0.0"/>
        </action>
    </quest>	
    <quest name="summonLeaf" locked="false">
        <trigger>
            <location name="igorlily" mover="!leaf"/>
            <use item="flut"/>
        </trigger>
        <action>
            <wait value="80"/>
      	    <sound name="SlipWater1"/>
            <moveTo what="leaf" pos="294,154"/>
      	    <sound name="SlipWater2"/>
            <moveTo what="leaf" pos="176,169"/>
        </action>
    </quest>
    
    <quest name="beenFishermanVillage">
        <trigger>
            <location name="igorvillage"/>
        </trigger>
    </quest>
    
    <quest name="minsk_fishes">
       	<trigger>
       	    <location name="igorv3"/>
       	    <dialog name="minsk" num="2"/>
       	</trigger>
       	<action>
    	    <moveTo who="zildo" pos="-16,0" speed="0.5" delta="true"/>
    	    <angle who="zildo" value="1"/>
    	    <moveTo who="minsk" pos="-14,12" speed="0.5" delta="true"/>
       	    <angle who="minsk" value="0"/>
       	</action>
    </quest>
    
    <quest name="1fishMinsk" repeat="true" locked="false">
        <trigger>
            <location name="igorv3b"/>
            <fall type="FISH" nature="WATER"/>
            <questDone name="!allFishMinsk"/>
        </trigger>
        <action>
            <var name="fishWater" value="fishWater+1"/>
            <if exp="fishWater=6">
				<sound name="ZildoAccomplishQuest"/>
				<markQuest name="allFishMinsk" value="true"/>
            </if>
        </action>
    </quest>
    
    <quest name="rewardMinsk" locked="false">
        <trigger>
            <location name="igorv3"/>
            <dialog name="minsk" num="4"/>
        </trigger>
        <action>
            <take item="FLASK_YELLOW"/>
        </action>
    </quest>

    <quest name="cheapDynamite" locked="false">
        <trigger>
            <location name="igorv4"/>
            <dialog name="boris" num="3"/>
        </trigger>
    </quest>
    
    <quest name="takeSawdust">
        <trigger>
            <location name="d5m2" pos="93,115" radius="2"/>
            <use item="EMPTY_BAG"/>
        </trigger>
        <action>
            <putDown item="EMPTY_BAG"/>
            <take item="FULL_BAG"/>
            <speak what="camera" text="d5m2.sawdust"/>
        </action>
    </quest>
    
    <quest name="giveSawdust" locked="false">
        <trigger>
            <location name="igorv4"/>
            <dialog name="boris" num="6"/>
        </trigger>
        <action>
            <putDown item="FULL_BAG"/>
			<sound name="ZildoAccomplishQuest"/>
        </action>
    </quest>
        
    <quest name="borisWait" locked="false">
        <!-- This quest is just a way of simulating wait once hero has given his bag to Boris -->
        <trigger>
            <questDone name="giveSawdust"/>
            <location name="igorvillage" pos="897,277" radius="2"/>
        </trigger>
    </quest>
    
    <quest name="backCoucou">
        <trigger>
            <location name="coucou"/>
            <questDone name="trig_echange"/>
        </trigger>
        <action>
            <exec script="zildoCrossCoucouNight"/>
        </action>
    </quest>
    
    <quest name="blockPrisonExt" repeat="true">
        <trigger>
            <questDone name="backCoucou-!retour_trion"/>
            <location name="prisonext" pos="368,6" radius="2"/>
        </trigger>
        <action>
            <speak who="zildo" text="pext.z.0"/>
            <moveTo who="zildo" pos="0,32" delta="true"/>
        </action>
    </quest>
    
    <quest name="retour_trion">
        <trigger>
			<location name="chateaucoucou2" pos="439,280" radius="2"/>
			<questDone name="trig_echange"/>
        </trigger>
        <action>
            <exec script="zildoReportKing"/>
        </action>
	</quest>
    			
    <quest name="zildoDream"> <!--  Signifie que la nuit est passée -->
	</quest>

    <quest name="hector_call1">
        <trigger>
            <location name="prisonext" pos="368,367" radius="4"/>
            <questDone name="retour_trion"/>
        </trigger>
        <action>
            <speak what="camera" text="pext.scr.hector.0"/>
        </action>
    </quest>
    
    <quest name="hector_call2">
        <trigger>
            <location name="prisonext" pos="687,346" radius="4"/>
            <questDone name="retour_trion"/>
        </trigger>
        <action>
            <wait value="50"/>
            <moveTo what="camera" delta="true" pos="64,32"/>
           	<speak what="camera" text="pext.scr.hector.1"/>
           	<moveTo what="camera" delta="true" pos="-64,-32"/>
		</action>
    </quest>
    
    <quest name="hector_call3">
        <trigger>
            <location name="prisonext" pos="912,468" radius="1"/>
            <questDone name="retour_trion-hector_call2"/>
        </trigger>
        <action>
            <exec script="meetHiddenHector"/>
        </action>
    </quest>
        
    <quest name="forbid_dynamiteCell">
    	<trigger>
    		<location name="prison"/>
    		<use item="dynamite"/>
    	</trigger>
    	<action>
    		<speak who="zildo" text="prison.gard.script"/>
    	</action>
    </quest>
    
    <quest name="ask_visitprison" locked="false">
        <trigger>
            <location name="prison"/>
            <dialog name="jaune" num="0"/>
        </trigger>
    </quest>
    
    <quest name="visit_igorprison">
		<trigger>
		    <location name="prison" pos="175,80" radius="1"/>
		    <questDone name="!visit_gpprison"/>	<!-- one at a time -->
		    <questDone name="ask_visitprison"/>
		    <questDone name="!zildoAccessIgor"/>
		</trigger>
		<action>
		    <script who="zildo" text="VIDE"/>	<!-- To reset his movement -->
   		    <moveTo who="jaune" pos="0,16" delta="true"/>
		    <angle who="zildo" value="0"/>
   		    <actions>
		        <moveTo who="jaune" pos="190,81"/>
		        <moveTo who="zildo" pos="188,108"/>
		    </actions>
		    <angle who="zildo" value="0"/>
		    <actions>
				<activate what="igordoor1" value="true"/>
		    	<activate what="igordoor2" value="true"/>
		    </actions>
   		    <angle who="gard2" value="3"/>
		    <moveTo who="jaune" pos="0,-10" delta="true"/>
		    <angle who="jaune" value="2"/>
		    <speak who="jaune" text="prison.gard.script"/>
		    <moveTo who="igor" pos="104,90" unstoppable="true"/>
		    <moveTo who="igor" pos="104,70"/>
		    <script who="igor" value="3"/>
		</action>        
    </quest>
   
    <quest name="visit_gpprison">
		<trigger>
		    <location name="prison" pos="175,206" radius="1"/>
		    <questDone name="!visit_igorprison"/>	<!-- one at a time -->
		    <questDone name="ask_visitprison"/>
		</trigger>
		<action>
		    <script who="zildo" text="VIDE"/>
		    <moveTo who="jaune" pos="0,80" delta="true"/>
		    <angle who="zildo" value="0"/>
		    <actions>
		        <moveTo who="jaune" pos="190,193"/>
		        <moveTo who="zildo" pos="188,220"/>
		    </actions>
		    <angle who="zildo" value="0"/>
		    <actions>
				<activate what="gpdoor1" value="true"/>
		    	<activate what="gpdoor2" value="true"/>
		    </actions>
		    <angle who="gard2" value="3"/>
		    <moveTo who="jaune" pos="0,-10" delta="true"/>
		    <angle who="jaune" value="2"/>
		    <speak who="jaune" text="prison.gard.script"/>
		</action>        
    </quest>

    <quest name="visit_igorprison_over" repeat="true">
        <trigger>
            <location name="prison" pos="228,168" radius="3"/>
            <questDone name="visit_igorprison"/>
        </trigger>
        <action>
            <script who="igor" value="0"/>
			<exec script="closePrisonIgorDoor"/>
        </action>
    </quest>

    <quest name="visit_gpprison_over" repeat="true">
        <trigger>	<!-- hero's leaving the prison -->
            <location name="prison" pos="228,270" radius="1"/>
            <questDone name="visit_gpprison"/>
        </trigger>
        <action>
            <markQuest name="visit_gpprison" value="0"/>
            <exec script="closePrisonGpDoor"/>
        </action>
    </quest>
    
    <quest name="visit_gpprison_over_2" repeat="true">
        <trigger> <!-- hero's leaving the cell -->
            <location name="prison" pos="228,138" radius="3"/>
            <questDone name="visit_gpprison"/>
        </trigger>
        <action>
            <exec script="closePrisonGpDoor"/>
        </action>
    </quest>
    
    <quest name="gp_talk_about_flut" locked="false">
        <trigger>
            <location name="prison"/>
            <dialog name="papy" num="5"/>
        </trigger>
    </quest>

    <quest name="igor_promise_sword" locked="false">
        <trigger>
            <location name="prison"/>
            <dialog name="igor" num="7"/>
        </trigger>
        <action>
            <sound name="ZildoAccomplishQuest"/>
        </action>
    </quest>
    
    <quest name="prison4_doors" locked="false">
        <trigger>
            <location name="prison4"/>
            <dead who="s1,s2"/>
        </trigger>
        <action>
            <activate what="doorl" value="true"/>
            <activate what="doorr" value="true"/>
        </action>
    </quest>
    
    <quest name="paid_gard">
        <trigger>
            <location name="prison"/>
            <dialog name="gard2" num="1"/>
        </trigger>
        <action>
            <take value="-10"/>
            <wait value="10"/>
            <moveTo who="gard2" pos="0,-10" delta="true" unstoppable="true"/>
            <!-- Unstoppable for the case where player reloads a game where hero is already near the cells -->
        	<moveTo who="gard2" pos="16,-4" delta="true" unstoppable="true"/>
        	<angle who="gard2" value="3"/>
        </action>
    </quest>
    
    <quest name="prison4_openDoors" locked="false">
        <trigger>
        	<location name="prison4"/>
        	<questDone name="prison4_doors"/>
        </trigger>
        <action>
            <actions>
				<activate what="doorl" value="true"/>
				<activate what="doorr" value="true"/>
            </actions>
		</action>
    </quest>
    
    <quest name="prison5_cell1kill">
        <trigger>
            <location name="prison5"/>
            <dead who="bigrat1"/>
            <questDone name="!prison5_cell2kill"/>
        </trigger>
        <action>
            <actions>
	            <activate what="doorc2a" value="true"/>
	            <activate what="doorc2b" value="true"/>
            </actions>
            <actions>
	            <activate what="doorc1a" value="true"/>
	            <activate what="doorc1b" value="true"/>
            </actions>
        </action>
    </quest>
    
    <quest name="prison5_cell2kill">
        <trigger>
            <location name="prison5"/>
            <dead who="rat1,rat2"/>
            <questDone name="!prison5_cell1kill"/>
        </trigger>
        <action>
            <actions>
	            <activate what="doorc2a" value="true"/>
	            <activate what="doorc2b" value="true"/>
            </actions>
            <actions>
	            <activate what="doorc1a" value="true"/>
	            <activate what="doorc1b" value="true"/>
            </actions>
        </action>
    </quest>
    
    <quest name="prison5_bigrat2kill" locked="false"> <!-- Optional quest to solve a deadlock, shown by Travis -->
        <trigger>
            <location name="prison5"/>
            <dead who="bigrat2"/>
        </trigger>
        <action>
            <actions>
	            <activate what="doorc1a" value="true"/>
	            <activate what="doorc1b" value="true"/>
            </actions>
        </action>
    </quest>
    
    <quest name="prison5_button1">
        <trigger>
            <location name="prison5" tilePos="42,26" gear="BUTTON"/>
        </trigger>
        <action>
			<activate what="door3a" value="true"/>
            <activate what="door3b" value="true"/>
        </action>
    </quest>
    
    <quest name="prison5_button2">
        <trigger>
            <location name="prison5" tilePos="56,26" gear="BUTTON"/>
        </trigger>
        <action>
            <activate what="door4" value="true"/>
        </action>
    </quest>
    
    <quest name="p5_trigger_smoke" locked="false">
        <trigger>
        	<location name="prison5"/>
        </trigger>
        <action>
            <actions>
	            <timer each="80+random*30">
	                <action>
		                <animation pos="392,302" type="SEWER_SMOKE" angle="2"/>
		            </action>
	            </timer>
	            <timer each="100+random*30">
	                <action>
		                <animation pos="263,302" type="SEWER_SMOKE" angle="2"/>
		            </action>
	            </timer>
		    </actions>
	    </action>
    </quest>
    
    <quest name="p6_trigger_smoke" locked="false">
        <trigger>
        	<location name="prison6"/>
        </trigger>
        <action>
            <actions>
	            <timer each="100">
	                <action>
		                <animation pos="200,503" type="SEWER_SMOKE" angle="2"/>
		            </action>
	            </timer>
	            <timer each="140">
	                <action>
		                <animation pos="21,218" type="SEWER_SMOKE" angle="1"/>
		                <wait value="70"/>
		                <animation pos="74,218" type="SEWER_SMOKE" angle="3"/>
		            </action>
	            </timer>
	            <timer each="100">
	                <action>
		                <animation pos="181,105" type="SEWER_SMOKE" angle="1"/>
		                <wait value="30"/>
		                <animation pos="181,105" type="SEWER_SMOKE" angle="1"/>
		            </action>
	            </timer>
	            <timer each="120">
	                <action>
		                <animation pos="166,298" type="SEWER_SMOKE" angle="1"/>
		                <wait value="30"/>
		                <animation pos="219,298" type="SEWER_SMOKE" angle="3"/>
		            </action>
	            </timer>
		    </actions>
	    </action>
    </quest>
    
    <quest name="prison7(22, 11)" locked="false">
        <!-- When the hero explodes the wall, we set the other one, on Igor's side, as exploded too -->
        <action>
            <markQuest name="prison(6, 2)" value="true"/>
        </action>
    </quest>
    
    <quest name="prison4l(9, 13)" locked="false">
        <action>
            <markQuest name="prison5(9, 2)" value="true"/>
        </action>
    </quest>

    <quest name="prison5(9, 2)" locked="false">
        <action>
            <markQuest name="prison4l(9, 13)" value="true"/>
        </action>
    </quest>
    
    <quest name="zildoAccessIgor">
        <trigger>
            <location name="prison" pos="96,33"/>
        </trigger>
        <action>
			<exec script="zildoSavesIgor"/>
		</action>
    </quest>
    
    <quest name="waitIgor" repeat="true" locked="false">
        <trigger>
            <questDone name="zildoAccessIgor-!freedIgor"/>
        </trigger>
        <action>
            <lookFor who="igor" radius="6" info="ZILDO" negative="true">
                <speak who="igor" text="followIgor.0"/>
                <wait value="150"/>
            </lookFor>
            <wait value="50"/>
            <markQuest name="waitIgor" value="false"/>
        </action>
    </quest>
    
    <quest name="waitIgorChaining">
        <trigger>
            <questDone name="zildoAccessIgor-!freedIgor"/>
            <chainingPoint/>                        
        </trigger>
        <action>
            <lookFor who="igor" radius="6" info="ZILDO" negative="true">
            	<markQuest name="waitIgorChaining" value="false"/>
                <speak who="igor" text="followIgor.0"/>
            </lookFor>
        </action>
    </quest>
    
    <quest name="blockZildoIgorPrison" repeat="true">
        <trigger>
            <questDone name="zildoAccessIgor-!freedIgor"/>
            <location name="prison" pos="580,320" radius="3"/>
        </trigger>
        <action>
            <speak who="zildo" text="prison.zildo.block"/>
            <moveTo who="zildo" delta="true" pos="48,0"/>
        </action>
    </quest>
    
    <quest name="freedIgor">
    	<trigger>
    	    <questDone name="zildoAccessIgor"/>
    	    <location name="prisonext"/>
    	</trigger>
    	<action>
    	    <exec script="liberationIgor"/>
    	</action>
    </quest>
    
    <quest name="meetLib1">
        <trigger>
            <location name="d4m2"/>
            <questDone name="hector_call3"/>
        </trigger>
        <action>
            <exec script="meetingLibrary"/>
        </action>
    </quest>
    
    <quest name="getBackIgor">
        <trigger>
            <questDone name="waitingForIgor"/>
            <location name="prisonext" pos="680,239" radius="1"/>
        </trigger>
        <action>
            <exec script="meetIgor"/>
        </action>
    </quest>

    <mapScript>
	    <!--  , means OR  -->
	    <!--  - means AND -->
	    <condition name="!prison">
	    	<var name="allowedDynamite" value="yes"/>
	    </condition>
	    <condition name="prison">
	    	<var name="allowedDynamite" value="no"/>
	    </condition>
	    <condition name="!chateaucoucou1-!chateaucoucou2-!voleursg1-!voleursg2-!voleursg3-!voleursg4-!voleursg5-!voleursg6-!voleursg7-!nature1" exp="trig_echange-!zildoDream,hero_princess">
	        <!-- Night -->
	        <filter type="1"/>
	    </condition>
	    <condition name="chateaucoucou1,chateaucoucou2,voleursg1,voleursg2,voleursg3,voleursg4,voleursg5,voleursg6,voleursg7,nature1">
	        <!-- Day -->
	        <filter type="0"/>
	    </condition>
	    <condition name="voleursg5">
	        <markQuest name="vg5_back" value="0"/>
	        <markQuest name="vg5_but2" value="0"/>
	        <markQuest name="vg5_but1" value="0"/>
	    </condition>
	    <condition name="promenade" exp="trig_echange-!fuite_tony1">
	        <spawn type="BANDIT_VERT" speed="1.3" pos="935,369" angle="0" who="tony"/>
	    	<script who="bunny" value="3"/>
	    </condition>
	    <condition name="promenade2" exp="trig_echange">
	        <spawn who="emissaire" pos="425,255" effect="jaune" type="GARDE_CANARD" angle="3"/>
	        <script who="emissaire" value="0"/>
	    </condition>
	    <condition name="voleurs" exp="!attaque_voleurs">
			<!-- Post guards -->
	        <spawn who="vert" pos="448,759" type="FOX" floor="2" effect="vert" weapon="BOW" foreground="true"/>
    	    <spawn type="FOX" who="rouge" effect="rouge" floor="2" pos="870,878"/>
    	    <spawn type="FOX" who="bleu" effect="bleu" pos="1039,922"/>
       	    <!-- Put knives -->
    	    <tile pos="55,32" back2="1277"/>
    	    <tile pos="56,32" back2="1277"/>
    	    <tile pos="57,32" back2="1277"/>
   	    </condition>
	    <condition name="voleurs" exp="attaque_voleurs">
			<tile pos="27,21" action="illTree"/> <tile pos="10,16" action="illTree"/>
		</condition>
		<condition name="voleurs" exp="attaque_voleurs-!beanCaveFlames">
		    <spawn type="FOX" who="rouge" pos="874,985" angle="3"/>
		    <spawn type="FOX" who="bleu" pos="880,998" angle="3"/>
		    <spawn type="FOX" who="vert" pos="839,924" angle="2" floor="2"/>
		    <music name="Attaque"/>
		</condition>
		<condition name="voleursg3" exp="trig_echange">
		    <actions>
		    	<animation type="BIG_FIREBALL" what="fireb1" angle="0" pos="144,302"/>
		    	<animation type="BIG_FIREBALL" what="fireb2" angle="0" pos="224,302"/>
		    </actions>
		    <wait value="20"/>
		    <actions>
			   	<animation type="BIG_FIREBALL" what="fireb3" angle="3" pos="320,131"/>
			    <animation type="BIG_FIREBALL" what="fireb4" angle="3" pos="320,211"/>
		    </actions>
   		</condition>
   		<condition name="voleursg6" exp="trig_echange">
		    <actions>
		    	<animation type="BIG_FIREBALL" what="fireb1" angle="0" pos="144,302"/>
		    	<animation type="BIG_FIREBALL" what="fireb2" angle="0" pos="224,302"/>
		    </actions>
		    <wait value="30"/>
		    <actions>
			   	<animation type="BIG_FIREBALL" what="fireb3" angle="1" pos="29,131"/>
			    <animation type="BIG_FIREBALL" what="fireb4" angle="1" pos="29,211"/>
		    </actions>
   		</condition>
   		<condition name="prisonext" exp="backCoucou">
			<remove who="hector"/>
   		</condition>
   		<condition name="prisonext" exp="retour_trion">
   		    <perso who="gardenord" type="GARDE_CANARD" effect="noir" info="ENEMY" pv="4"/>
   		    <perso who="gard2" type="GARDE_CANARD" effect="noir" info="ENEMY" pv="4"/>
   		    <perso who="gard3" type="GARDE_CANARD" effect="noir" info="ENEMY" pv="4"/>
   		    <perso who="gard4" type="GARDE_CANARD" effect="noir" info="ENEMY" pv="4"/>
   		    <perso who="gard5" type="GARDE_CANARD" effect="noir" info="ENEMY" pv="4"/>
   		    <script who="gardenord" value="3"/>
   		    <script who="gard3" value="3"/>
	   		<script who="gard4" value="3"/>
   		    <!-- Open the prison and block gard before episode 4 castle attack-->
   		    <if expQuest="!findDragonPortalKey">
   		    	<script who="gard2" value="3"/>
   		        <script who="gard5" value="3"/>
   		        <remove what="prisondoor"/>
   		    </if>
   		</condition>
   		<condition name="prisonext" exp="retour_trion-!hector_call3">
   		  	<tile pos="56,32" back="512"/>
   		    <spawn who="hector" pos="906,525" angle ="0" type="HECTOR" info="NEUTRAL"/>
   		    <perso who="hector" action="hiddenHector"/>
		</condition>
		<condition name="prisonext" exp="retour_trion-hector_call3">
		    <remove who="hector"/>
		</condition>
		<condition name="prisonext" exp="retour_trion">
		    <if expQuest="!findDragonPortalKey">
			    <tile pos="15,41" back2="181"/>
			    <tile pos="16,41" back2="180"/>
			    <tile pos="17,41" back2="182"/>
			    <tile pos="15,42" back2="179"/>
			    <tile pos="15,43" back2="185"/>
			    <tile pos="17,42" back2="179" reverse="128"/>
			    <tile pos="17,43" back2="185" reverse="128"/>
			    <!-- Block path down the lake (Issue 63 point 6 and 7 )-->
			    <tile pos="25,43" back2="181"/>
			    <tile pos="26,43" back2="180"/>
	   		    <tile pos="27,43" back2="182"/>
	   		    <tile pos="25,44" back2="34+256"/>
   		    </if>
   		    <!-- Make gard asking money to hero in order to visit prisoners -->
   		    <markQuest name="paid_gard" value="false"/>
   		</condition>
		<condition name="prisonext" exp="retour_trion-!hector_call3">
		    <!-- Repeat Pssst if player hasn't seen Hector yet -->
		    <markQuest name="hector_call1" value="false"/>
		    <markQuest name="hector_call2" value="false"/>
		</condition>
		<condition name="prisonext" exp="freedIgor-!getBackIgor">
		    <spawn who="igor" pos="670,228" angle="2" type="IGOR"/>
		</condition>
		<condition name="voleursm1">
		    <perso who="rouge" action="sleeping"/>
		    <perso who="violet" action="sleeping"/>
		</condition>
		<condition name="voleursm2">
		    <perso who="vert" action="sleeping"/>
		</condition>
		<condition name="voleursm3" exp="!v3_crate-!voleursm3(8,8)">
		    <tile pos="8,8" back2="-1"/>
		</condition>
		<condition name="voleursm4b">
			<!-- Just to place correctly the candle on the small table -->
		    <pos what="candle" pos="0,6" delta="true" z="6"/>
		</condition>
		<condition name="voleursm4" exp="!voleursm4(13, 3)">
		    <remove who="falcor"/>
		</condition>
		<condition name="voleursm4b" exp="!voleursm4(13, 3)">
		    <perso who="falcor" action="sleeping"/>
		</condition>
		<condition name="voleursm4b" exp="voleursm4(13, 3)">
		    <remove who="falcor"/>
		</condition>
		<condition name="voleursm4" exp="!voleursm4_button">
		    <tile pos="16,11" back="256*2+33"/>
			<tile pos="17,11" back="256*2+33"/>
			<tile pos="17,10" back2="-1"/>
			<tile pos="18,10" back2="-1"/>
			<tile pos="18,11" back2="-1"/>
			<remove chaining="voleurscave"/>
		</condition>
		<condition name="voleursm4b" exp="voleursm4_button">
		    <tile pos="3,11"  back="256*3+212" back2="-1"/>"
		</condition>
		<condition name="bucherons" exp="attaque_voleurs">
		    <remove who="garde"/>
		</condition>
		<condition name="igorlily">
		    <markQuest name="summonLeaf" value="0"/>
		    <markQuest name="lily" value="0"/>	<!-- To fix Amanda's bug -->
		    <zikReplace what="Village" name="Nuit"/> <!--  Returns to alarming music -->
		</condition>
		<condition name="igorv3" exp="minsk_fishes">
		    <pos who="minsk" pos="-14,12" delta="true"/>
		    <angle who="minsk" value="2"/>
		    <herospecial value="9"/>
		</condition>
		<condition name="igorvillage">
		    <markQuest name="summonLeafVillage" value="0"/>
		   	<markQuest name="lily" value="0"/>
		    <zikReplace what="Village" name="Village"/>	<!--  plays Village music in this peaceful island -->
		</condition>
		<condition name="igorv2"> <!-- Igor will come back home later -->
		    <remove who="igor"/>
		</condition>
		<condition name="igorv3b" exp="!allFishMinsk">
		    <!-- If this variable is stored into a game, the following should override it. -->
		    <var name="fishWater" value="0"/>
		</condition>
		<condition name="igorv3b" exp="allFishMinsk">
		    <pos who="f1" pos="170,125"/>
		    <pos who="f2" pos="160,112"/>
   		    <pos who="f3" pos="130,126"/>
   		    <pos who="f4" pos="150,116"/>
   		    <pos who="f5" pos="125,113"/>
   		    <pos who="f6" pos="145,121"/>
   		</condition>
   		<condition name="coucou" exp="attaque_voleurs-!zildoDream">
   		    <remove who="vieille"/>
   		    <remove who="petula"/>
   		    <remove who="c1"/>
   		    <remove who="c2"/>
   		    <remove who="p1"/>
   		    <remove who="p2"/>
   		    <remove who="p3"/>
   		    <remove who="p4"/>
   		    <remove who="p5"/>
   		</condition>
   		<condition name="coucou" exp="attaque_voleurs">
   		    <remove who="mostapha"/>
   		    <remove who="papy"/>
   		    <remove who="garde"/>
   		    <tile pos="35,13" action="illTree"/>
   		    <tile pos="35,0" action="illTree"/>
   		    <tile pos="27,13" action="illTree"/>
   		    <tile pos="48,32" action="illTree"/>
   		    <tile pos="50,53" action="illTree"/>
   		    <tile pos="12,46" action="illTree"/>
   		</condition>
   		<condition name="ferme" exp="attaque_voleurs"> <!-- Devastated fields -->
   		    <tile pos="38,43" back="474"/> <tile pos="43,43" back="474"/> <tile pos="44,40" back="474"/>
   		    <tile pos="47,43" back="474"/> <tile pos="53,43" back="474"/> <tile pos="55,42" back="474"/>
   		    <tile pos="54,40" back="474"/> <tile pos="5,38" back="474"/> <tile pos="4,40" back="474"/>
   		    <tile pos="7,39" back="474"/> <tile pos="8,40" back="474"/> <tile pos="4,43" back="474"/>
   		    <tile pos="6,43" back="474"/> <tile pos="7,44" back="474"/> <tile pos="8,45" back="474"/>
   		    <tile pos="9,43" back="474"/> <tile pos="11,43" back="474"/> <tile pos="11,41" back="474"/>
   		    <tile pos="9,47" back="474"/> <tile pos="12,46" back="474"/> <tile pos="15,40" back="474"/>
   		    <tile pos="18,39" back="474"/> <tile pos="15,43" back="474"/> <tile pos="17,42" back="474"/>
   		    <tile pos="17,45" back="474"/> <tile pos="18,45" back="474"/> <tile pos="16,48" back="474"/>
   		    <tile pos="18,49" back="474"/> <tile pos="14,51" back="474"/> <tile pos="14,53" back="474"/>
   		    <tile pos="12,54" back="474"/> <tile pos="18,53" back="474"/> <tile pos="6,52" back="474"/>
   		    <tile pos="7,51" back="474"/> <tile pos="7,48" back="474"/> <tile pos="9,47" back="474"/>
   		    <tile pos="11,49" back="474"/>
   		    <tile pos="51,42" back="487"/> <tile pos="50,43" back="487"/> <tile pos="46,42" back="487"/>
   		    <tile pos="45,41" back="487"/> <tile pos="39,41" back="487"/> <tile pos="42,41" back="487"/>
   		    <tile pos="4,39" back="487"/> <tile pos="7,43" back="487"/> <tile pos="5,46" back="487"/>
   		    <tile pos="5,51" back="487"/> <tile pos="7,49" back="487"/> <tile pos="13,50" back="487"/>
   		    <tile pos="13,53" back="487"/> <tile pos="17,48" back="487"/> <tile pos="18,51" back="487"/>
   		    <tile pos="16,42" back="487"/> <tile pos="18,44" back="487"/> <tile pos="14,40" back="487"/>
   		    <tile pos="18,11" action="illTree"/><tile pos="28,16" action="illTree"/>
   		    <tile pos="35,28" action="illTree"/><tile pos="48,53" action="illTree"/>
   		</condition>
   		<condition name="igorlily" exp="attaque_voleurs">
   		    <tile pos="1,7" action="illTree"/>
   		</condition>
   		<condition name="bosquet" exp="attaque_voleurs">
   		    <tile pos="7,13" action="illTree"/> <tile pos="0,12" action="illTree"/>
   		</condition>
   		<condition name="bucherons" exp="attaque_voleurs">
   		    <tile pos="8,23" action="illTree"/> <tile pos="2,18" action="illTree"/>
   		    <tile pos="4,3" action="illTree"/>
   		</condition>
   		<condition name="buchforet" exp="attaque_voleurs">
   		    <tile pos="19,4" action="illTree"/> <tile pos="38,17" action="illTree"/>
   		</condition>
   		<condition name="polaky" exp="attaque_voleurs">
   		    <tile pos="13,6" action="illTree"/> <tile pos="8,14" action="illTree"/>
   		    <tile pos="9,34" action="illTree"/> <tile pos="52,41" action="illTree"/>
   		    <tile pos="59,8" action="illTree"/>
   		</condition>
   		<condition name="chateaucoucou2" exp="trig_echange">
   		    <remove who="maltus"/>
		    <spawn who="hector" type="HECTOR" pos="355,222" angle="1"/>
	    	<spawn who="maltus" type="BANDIT_CHAPEAU" pos="580,236" angle="1"/>   		    
   		</condition>
   		<condition name="prison">
   		    <perso who="gard2" effect="jaune"/>	<!--  workaround because effect is not editable yet in ZEditor-->
   		    <if expQuest="paid_gard">
   		    	<pos who="gard2" pos="16,-14" delta="true"/>
   		    	<angle who="gard2" value="3"/>
   		    </if>
   		    <!-- 
   		    -->
   		</condition>
   		<condition name="prison" exp="zildoAccessIgor">
   		    <remove who="igor"/>
   		</condition>
   		<condition name="prison" exp="visit_igorprison">
			<activate what="igordoor1" value="true" unblock="true"/>
	    	<activate what="igordoor2" value="true" unblock="true"/>
   		</condition>
   		<condition name="prison" exp="visit_gpprison">
			<activate what="gpdoor1" value="true" unblock="true"/>
	    	<activate what="gpdoor2" value="true" unblock="true"/>
   		</condition>
   		<condition name="prison3">
   		    <markQuest name="prison4_doors" value="false"/>
   		</condition>
   		<condition name="prison4">
			<markQuest name="prison4_openDoors" value="false"/> <!--  Because door opening is buggy when targeted here -->
   		</condition>
   		<condition name="prison5">
   		    <markQuest name="p5_trigger_smoke" value="false"/>
   		    <markQuest name="prison5_cell1kill" value="false"/>
   		    <markQuest name="prison5_cell2kill" value="false"/>
   		</condition>
   		<condition name="prison5" exp="prison5_button1">
			<activate what="door3a" value="true" unblock="true"/>
            <activate what="door3b" value="true" unblock="true"/>
   		</condition>
   		<condition name="prison5" exp="prison5_button2">
   		    <remove what="door4"/> 
   		</condition>
   		<condition name="prison6,prison7">
   		    <markQuest name="p6_trigger_smoke" value="false"/>
   		</condition>
   		<condition exp="zildoAccessIgor-!freedIgor" scroll="false">
   		    <!-- Igor is following hero until they get out of the prison -->
   		    <spawn who="igor" pos="zildo.x,zildo.y" type="IGOR" speed="0.7"/>
   		    <!-- <visible who="igor" value="false"/> -->
   		    <script who="igor" value="16" effect="zildo"/>
   		</condition>
   		<condition name="coucou" exp="!secretDoorRevealed">
   		    <!-- Reactive quest when hero talk with his friends (maybe one day, think about different dialog for the second time) -->
   		    <!-- We have to be careful, because this quest SHOULDN'T be reset inside the house, but outside (see Issue 63 point 9) -->
   		    <markQuest name="meetLib1" value="false"/>
   		</condition>
   		<condition name="d4m2" exp="secretDoorRevealed">
	    	<activate what="hiddendoor" value="true" unblock="true"/>
   		</condition>
   		<condition name="d4m2" exp="!hector_call3">
   		    <remove who="hector"/>
   		    <remove who="maltus"/>
   		</condition>
   		<condition name="d4m2b,lugduniag">	<!--  Backward compatibility ! Because it didn't exist in 2.11 -->
   		    <markQuest name="secretDoorRevealed" value="true"/>
   		</condition>
   	</mapScript>

	<scene id="intro_episode2">
	    <speak who="synthe" text="info.episode2"/>
	    <!-- Get back to life for the two people -->
	    <script who="tony" value="3"/>
	    <script who="emissaire" value="3"/>
	   	<!--  Real scene -->
	    <moveTo who="tony" pos="32,2" delta="true" unstoppable="true" speed="2"/>
	    <actions>
		    <angle who="emissaire" value="1"/>
		    <angle who="zildo" value="2"/>
		    <speak who="emissaire" text="echange.ep2.emissaire1"/>
		    <moveTo who="tony" pos="96,96" delta="true" unstoppable="true" />
	    </actions>
   	    <actions>
   	    	<moveTo who="tony" pos="60,0" delta="true" unstoppable="true" />
   	       	<moveTo who="emissaire" pos="4,6" delta="true"/>
   	    </actions>
	    <remove who="tony"/>
	    <moveTo who="zildo" pos="0,8" delta="true"/>
	    <wait value="10"/>
	    <moveTo who="emissaire" pos="-8,2" delta="true"/>
	    <wait value="10"/>
	    <moveTo who="emissaire" pos="2,0" delta="true"/>
	    <wait value="20"/>
	    <speak who="emissaire" text="echange.ep2.emissaire"/>
	    <actions>
	        <moveTo who="zildo" pos="-8,4" delta="true"/>
			<speak who="zildo" text="echange.ep2.zildo"/>
	    </actions>
		<speak who="emissaire" text="echange.ep2.emissaire2"/>
		<actions>
		    <focus who="zildo" delta="true"/>
		    <moveTo who="emissaire" pos="-42,2" delta="true" speed="0.5"/>
		</actions>
	</scene>
	
	<scene id="attaqueV">
	    <music name="Attaque"/>
	    <speak who="rouge" text="voleurs.fox1" unblock="true"/>
	    <actions>
            <moveTo who="rouge" pos="-32,4" delta="true" unstoppable="true" speed="1.5"/>
            <moveTo who="bleu" pos="-68,8" delta="true" unstoppable="true" speed="1.5"/>
            <angle who="zildo" value="1"/>
	    </actions>
	    <actions>
        	<moveTo who="rouge" pos="0,100" delta="true"/>
			<moveTo who="bleu" pos="913,998"/>
			<moveTo who="zildo" pos="890,1005" speed="0.5"/>     
	    </actions>
	    <pos who="vert" pos="713,764"/>
	    <angle who="bleu" value="3"/>
	    <moveTo who="rouge" pos="870,980"/>
	    <angle who="rouge" value="2"/>
	    <angle who="zildo" value="0"/>
	    <speak who="bleu" text="voleurs.fox2"/>
	    <angle who="zildo" value="2"/>
	    <moveTo who="rouge" pos="872,982" unblock="true"/>
	    <speak who="rouge" text="voleurs.fox3"/>
	    <moveTo who="bleu" pos="910,998" unblock="true"/>
	    <angle who="zildo" value="1"/>
	    <perso who="vert" weapon="BOW"/>
	    <moveTo who="vert" pos="723,893" unblock="true" speed="1"/>
	    <speak who="bleu" text="voleurs.fox4"/>
	    
	    <actions>
	        <moveTo who="bleu" pos="900,998"/>
	        <moveTo who="zildo" pos="880,1005" backward="true"/>
	    </actions>
   	    <speak who="bleu" text="voleurs.fox5"/>
   	    <moveTo who="rouge" pos="874,985" unblock="true"/>
   	    <putDown item="SWORD"/>
   	    <speak who="bleu" text="voleurs.fox6"/>
   	    <actions>
   	    	<moveTo who="bleu" pos="889,1004"/>
   	    	<moveTo who="zildo" pos="873,1005" backward="true"/>
   	    </actions>
   	    <var name="moneyStolen" value="zildo.money"/>
   	    <take value="-999"/>
   	    <moveTo who="vert" pos="807,906" unblock="true"/>
   	    <speak who="bleu" text="voleurs.fox7"/>
   	    <actions>
   	    	<moveTo who="bleu" pos="-20,0" delta="true" speed="1.5"/>
   	    	<moveTo who="zildo" pos="-25,0" delta="true" backward="true" speed="1.5"/>
	   	    <speak who="bleu" text="voleurs.fox8"/>
	   	    <moveTo who="vert" pos="839,924"/>
   	    </actions>
   	    <angle who="rouge" value="3"/>
   	    <angle who="vert" value="2"/>
   	    <attack who="vert"/>
   	    <wait value="10"/>
   	    <angle who="zildo" value="0"/>
   	   	<wait value="5"/>
   	    <moveTo who="zildo" pos="-32,0" delta="true"/>
   	    <angle who="zildo" value="1"/>
   	</scene>
   	
	<scene id="move_vg5_plat1">
	    <moveTo what="platform" pos="-220,0" delta="true" way="easein"/>
	    <wait value="60"/>
	    <moveTo what="platform" pos="220,0" delta="true" way="easein"/>
	    <wait value="10"/>
	</scene>
	<scene id="move_vg5_plat2">
	    <moveTo what="platform2" pos="0,128" delta="true" way="easein"/>
	    <wait value="180"/>
	    <moveTo what="platform2" pos="0,-128" delta="true" way="easein"/>
	    <wait value="10"/>
	</scene>
	
	<scene id="disturbVoleurs">
		<lookFor who="zildo" radius="8" info="ENEMY">
            <wait value="4"/>
            <sound name="ZildoLance"/> 
            <script who="self" text="BRAS_LEVES"/>
		    <throw who="self" pos="x+7, y+4" to="zildo.x+random*12-6,zildo.y+random*12-6" speed="1.6"
       		 	   type="ROCK_BALL" shadow="SHADOW_MINUS" z="16" az="-0.08" way="BELL"/>
		    <wait value="20"/>
		    <script who="self" text="VIDE"/>
		</lookFor>
		<wait value="50"/>
	</scene>

	<scene id="voleurs_discutent" restoreZildo="true">
	    <speak what="camera" text="voleurs.chat.off" />
	    <fadeOut type="0"/>
	    <map name="voleurs" />
	   	<spawn pos="122,664" type="FOX" who="rouge" angle="2" fx="rouge"/>
	    <spawn pos="81,666" type="FOX" who="bleu" angle="1" fx="bleu"/>
	   	<spawn pos="139,702" type="FOX" who="vert" weapon="BOW" angle="3" fx="vert"/>
	    	   	
	    <pos what="camera" pos="8,570" />
	    <moveTo who="rouge" pos="40,0" delta="true" unblock="true"/>
	    <fadeIn type="0"/>
	    <wait value="120"/>
	    <moveTo who="rouge" pos="-40,8" delta="true"/>
	    <wait value="20"/>
	    <angle who="rouge" value="2"/>
	    <speak who="rouge" text="voleurs.chat.rouge0"/>
	    <speak who="rouge" text="voleurs.chat.rouge1"/>
	    <angle who="rouge" value="3"/>
	    <speak who="bleu" text="voleurs.chat.violet1"/>
	    <attack who="vert"/>
	    <wait value="90"/>
	    <angle who="rouge" value="2"/>
	    <angle who="vert" value="0"/>
		<speak who="vert" text="voleurs.chat.vert1"/>
	   	<speak who="rouge" text="voleurs.chat.rouge2"/>
	    <speak who="vert" text="voleurs.chat.vert2"/>
	   	<speak who="rouge" text="voleurs.chat.rouge3"/>
	   	<wait value="20"/>
	   	<moveTo who="rouge" pos="128,-32" delta="true" unblock="true"/>
		<speak who="rouge" text="voleurs.chat.rouge4" unblock="true"/>
   	    <wait value="150"/>
	    <speak who="bleu" text="voleurs.chat.violet2"/>
	    <angle who="vert" value="0"/>
	    <angle who="rouge" value="3"/>
	    <speak who="vert" text="voleurs.chat.vert3"/>
	    <wait value="20"/>
	    <moveTo who="bleu" pos="16,-32" delta="true" unblock="true"/>
	    <moveTo who="vert" pos="0,-32" delta="true" unblock="true"/>
	    <wait value="10"/>
	    <moveTo who="rouge" pos="48,0" delta="true" unblock="true"/>
	    <fadeOut type="0"/>
	</scene>
	
	<scene id="falcor_arrive">
	    <music name=""/>
	    <sound name="MenuSelect"/>"
	    <moveTo who="zildo" pos="215,70"/>
	    <angle who="zildo" value="1"/>
	    <wait value="60"/>
	    <angle who="zildo" value="1"/>
	    <wait value="30"/>
	    <spawn who="falcor" type="FALCOR" pos="301,68" speed="1"/>
	    <moveTo who="falcor" pos="-36,0" delta="true"/>
	    <filter type="4"/>
		<wait value="20"/>
		<filter type="0"/>
		<filter type="1"/>
		<music name="Falcor"/>
		<speak who="falcor" text="voleursm4.falcor1"/>
	    <speak who="falcor" text="voleursm4.falcor2"/>
	    <actions>
		    <speak who="zildo" text="voleursm4.zildo1"/>
			<moveTo who="zildo" pos="-4,0" delta="true" backward="true"/>	        
	    </actions>
	    <angle who="zildo" value="1"/>
	    <actions>
		    <speak who="falcor" text="voleursm4.falcor3"/>
		    <moveTo who="falcor" pos="229,68"/>
	    </actions>
		<speak who="zildo" text="voleursm4.zildo2"/>
		<actions>
		    <speak who="falcor" text="voleursm4.falcor4"/>
		    <moveTo who="falcor" pos="-2,0" delta="true"/>
		</actions>
	    <speak who="zildo" text="voleursm4.zildo3"/>
		<speak who="falcor" text="voleursm4.falcor5"/>
		<wait value="20"/>
		<moveTo who="falcor" pos="0,16" delta="true"/>
		<wait value="50"/>
		<angle who="falcor" value="0"/>
		<moveTo who="falcor" pos="0,-14" delta="true" speed="0.5"/>
		<wait value="25"/>
		<angle who="falcor" value="3"/>
		<speak who="falcor" text="voleursm4.falcor6"/>
		<speak who="zildo" text="voleursm4.zildo4"/>
		<speak who="falcor" text="voleursm4.falcor7"/>
		<speak who="zildo" text="voleursm4.zildo5"/>
		<nameReplace who="falcor" name="falcor"/>
		<speak who="falcor" text="voleursm4.falcor8"/>
		<speak who="falcor" text="voleursm4.falcor9"/>
		<moveTo who="falcor" pos="243,149" unblock="true" speed="1"/>
		<wait value="10"/>
		<moveTo who="zildo" pos="240,130" speed="1"/>
		<actions>
			<moveTo who="falcor" pos="160,186"/>
		    <moveTo who="zildo" pos="240,186"/>
		</actions>
		<actions>
		    <moveTo who="falcor" pos="160,237"/>
		    <moveTo who="zildo" pos="160,186"/>
		</actions>
		<moveTo who="zildo" pos="160,220"/>
		<fadeOut type="2"/>
		<map name="voleurs"/>
		<spawn who="falcor" type="FALCOR" pos="223,607"/>
		<pos who="zildo" pos="223,590"/>
		<fadeIn type="2"/>
		<moveTo who="falcor" pos="0,11" delta="true" open="true"/>
		<moveTo who="falcor" pos="16,0" delta="true"/>
		<angle who="falcor" value="3"/>
		<moveTo who="zildo" pos="0,48" delta="true"/>
		<moveTo who="falcor" pos="-14,0" delta="true"/>
		<angle who="falcor" value="2"/>
		<angle who="zildo" value="0"/>
		<speak who="falcor" text="voleursm4.falcor10"/>
		<speak who="zildo" text="voleursm4.zildo6"/>
		<speak who="falcor" text="voleursm4.falcor11"/>
		<speak who="falcor" text="voleursm4.falcor12"/>
		<music name="Nuit"/>
	</scene>

	<scene id="moveLeaf">
	    <moveTo what="leaf" pos="-2*zildo.angle.x,-2*zildo.angle.y" way="physic" unblock="true"/>
	    <wait value="5"/>
	    <actions> <!-- All action in 1 frame to avoid wasting time -->
		    <sound name="SlipWater1"/>
		   	<markQuest name="summonLeaf" value="1"/>
		   	<markQuest name="summonLeafVillage" value="1"/>
	    </actions>
	</scene>
	
	<scene id="zildoCrossCoucouNight">
	    <speak who="zildo" text="coucou.z.0"/>
	    <moveTo who="zildo" speed="1.5" pos="874,500"/>
		<moveTo who="zildo" pos="874,593"/>
		<speak who="zildo" text="coucou.z.1" unblock="true"/>
		<moveTo who="zildo" pos="927,596"/>
		<moveTo who="zildo" pos="924,726"/>
		<moveTo who="zildo" pos="808,738"/>
		<moveTo who="zildo" pos="542,915"/>
		<moveTo who="zildo" pos="381,961"/>
	   	<angle who="zildo" value="3"/>
	   	<wait value="20"/>
	   	<speak who="zildo" text="coucou.z.2"/>
	   	<moveTo who="zildo" pos="368,1025"/>
	   	<!--  switch map to prisonext -->
	   	<wait value="20"/>
	   	<remove who="hector"/>
	   	<moveTo who="zildo" pos="368,64"/>
	</scene>
	
	<scene id="zildoReportKing">
		<moveTo who="zildo" pos="0,-1" delta="true"/>
		<angle who="zildo" value="0"/>
		<moveTo what="camera" pos="0,-48" delta="true"/>
		<angle who="maltus" value="3"/>
		<angle who="hector" value="2"/>
		<speak who="king" text="chc2.king.0"/>
		<speak who="zildo" text="chc2.zildo.0"/>
		<moveTo who="hector" pos="4,24" delta="true" speed="0.5"/>
		<speak who="king" text="chc2.king.1"/>
		<speak who="zildo" text="chc2.zildo.1"/>
		<filter type="4"/>
		<script who="gard2" value="3"/>
		<angle who="gard2" value="2"/>
		<wait value="20"/>
		<filter type="0"/>
		<moveTo who="maltus" pos="522,250" speed="1.5" unblock="true"/>
		<speak who="king" text="chc2.king.2"/>
		<wait value="10"/>
		<speak who="king" text="chc2.king.3"/>
		<wait value="20"/>
		<speak who="king" text="chc2.king.4"/>
		<fadeOut value="0"/>
		<wait value="100"/> <!-- Long story -->
		<pos who="maltus" pos="439,273"/>
		<pos who="hector" pos="383,279"/>
		<angle who="hector" value="1"/>
		<angle who="maltus" value="2"/>
		<fadeIn value="0"/>
		 
		<speak who="king" text="chc2.king.5"/>
		<angle who="maltus" value="0"/>
		<speak who="king" text="chc2.king.6"/>
		<speak who="king" text="chc2.king.7"/>
		<speak who="king" text="chc2.king.8"/>
		<speak who="zildo" text="chc2.zildo.2"/>
		<speak who="king" text="chc2.king.9"/>
		<speak who="king" text="chc2.king.10"/>
		<speak who="zildo" text="chc2.zildo.3"/>
		
		<wait value="20"/>
		<angle who="zildo" value="1"/>
		<wait value="10"/>
		<angle who="zildo" value="2"/>
		<wait value="10"/>
		<focus who="zildo" delta="true"/>
		<focus/>
		<moveTo who="zildo" pos="440,470" speed="1" unblock="true"/>
		<wait value="100"/>
		<fadeOut value="2"/>
		<wait value="80"/>
		<map name="d4m12"/>
		<pos who="zildo" pos="144,170"/>
		<fadeIn value="2" unblock="true"/>
		<moveTo who="zildo" pos="0,-32" delta="true" speed="0.8"/>
		<angle who="zildo" value="3"/>
		<speak who="zildo" text="chc2.zildo.4"/>
		<moveTo who="zildo" pos="104,82" speed="1" unblock="true"/>
		<wait value="50"/>
		<angle who="zildo" value="3"/>
		<fadeOut value="1"/>
		<music name=""/>
		<wait value="200"/>
		<exec script="zildoDreams"/>
	</scene>
	
	<scene id="zildoDreams">
	    <pos who="zildo" pos="79,79"/>
	  	<perso who="zildo" action="sleeping"/>
	  	<script who="zildo" text="SLEEPING"/>
	  	<filter type="0"/>
	    <fadeIn value="1"/>
	    <wait value="150"/>
    	<sound name="MenuMove"/><wait value="10"/>
       	<sound name="MenuMove"/><wait value="10"/>
    	<sound name="MenuMove"/><wait value="10"/>
    	<wait value="100"/>
       	<sound name="MenuMove"/><wait value="10"/>
    	<sound name="MenuMove"/><wait value="10"/>
       	<sound name="MenuMove"/><wait value="10"/>
    	<sound name="MenuMove"/><wait value="10"/>
    	<wait value="50"/>
	    <sound name="OuvrePorte"/>
	    <spawn who="petula" type="RITASKY" pos="144,170" alpha="0" alphaA="2"/>
	    <perso who="zildo" action=""/>
	    <script who="zildo" text="WAKEUP"/>
	    <wait value="150"/>
	    <speak who="petula" text="zildo.house.a.1"/>
	    <wait value="30"/>
	    <speak who="zildo" text="zildo.house.zildo.1"/>
	    <moveTo who="petula" delta="true" pos="0,-32"/>
	    <angle who="petula" value="3"/>
	    <speak who="petula" text="zildo.house.a.2"/>
	    <speak who="zildo" text="zildo.house.zildo.2"/>
	    <speak who="petula" text="zildo.house.a.3"/>	    
	    <speak who="zildo" text="zildo.house.zildo.3"/>
	    <moveTo who="petula" delta="true" pos="0,32"/>
	    <perso who="petula" alphaA="-2"/>
	    <wait value="30"/>
	    <remove who="petula"/>
	    <script who="zildo" text="VIDE"/>
	    <angle who="zildo" value="1"/>
	    <moveTo who="zildo" pos="48,16" delta="true"/>
	    <markQuest name="zildoDream" value="true"/>
	</scene>
	
	<scene id="meetHiddenHector">
	    <perso who="hector" action=""/>
	    <moveTo who="zildo" pos="916,475"/>
	    <moveTo who="hector" pos="913,525" unstoppable="true"/>
	    <speak who="hector" text="pext.scr.hector.2"/>
	    <actions>
	    	<moveTo who="hector" pos="920,525" unstoppable="true"/>
	    	<moveTo who="zildo" pos="919,485"/>
	    </actions>
	    <moveTo who="hector" pos="920,515"/>
	    <speak who="hector" text="pext.scr.hector.3"/>
	    <speak who="hector" text="pext.scr.hector.4"/>
	    <moveTo who="zildo" pos="0,4" unblock="true" delta="true"/>
	    <speak who="zildo" text="pext.scr.zildo.0"/>
  	    <speak who="hector" text="pext.scr.hector.5"/>
	    <speak who="hector" text="pext.scr.hector.6"/>
	    <speak who="zildo" text="pext.scr.zildo.1"/>
	    <sound name="ZildoAccomplishQuest"/>
	    <speak who="hector" text="pext.scr.hector.7"/>
	    <wait value="30"/>
	    <angle who="hector" value="3"/>
	    <wait value="20"/>
	    <angle who="hector" value="0"/>	    
	    <speak who="hector" text="pext.scr.hector.8"/>
	    <speak who="hector" text="pext.scr.hector.9"/>
	    <moveTo who="hector" pos="919,525"/>
	    <moveTo who="hector" pos="904,525" unstoppable="true"/>
	    <remove who="hector"/>
	    <tile pos="56,32" back="95+256"/>
	</scene>
	
	<scene id="closePrisonIgorDoor">
        <markQuest name="visit_igorprison" value="0"/>
        <markQuest name="visiting_igorprison" value="0"/>
        <moveTo who="jaune" pos="0,10" delta="true"/> 
        <angle who="jaune" value="3"/>
	    <actions>
			<activate what="igordoor1" value="false"/>
	    	<activate what="igordoor2" value="false"/>
	    </actions>
	    <moveTo who="jaune" pos="223,60"/>	    
   	    <angle who="jaune" value="2"/>
	</scene>

	<scene id="closePrisonGpDoor">
        <markQuest name="visit_gpprison" value="0"/>
        <markQuest name="visiting_gpprison" value="0"/>
        <script who="zildo" text="VIDE"/>
        <moveTo who="zildo" pos="230,256"/>
        <moveTo who="jaune" pos="0,10" delta="true"/> 
        <angle who="jaune" value="3"/>
	    <actions>
			<activate what="gpdoor1" value="false"/>
	    	<activate what="gpdoor2" value="false"/>
	    </actions>
	    <moveTo who="jaune" pos="223,142"/>
	    <exec script="prisonLeaveGard" unblock="true"/>
  	</scene>

	<scene id="prisonLeaveGard">	<!-- To avoid blocking player when gard returns -->
   	    <moveTo who="jaune" pos="223,60"/>
   	    <angle who="jaune" value="2"/>
	</scene>	

	<scene id="zildoSavesIgor">
	    <script who="igor" value="3"/>
	    <angle who="igor" value="0"/>
	    <angle who="jaune" value="3"/>
	    <wait value="50"/>
	    <speak who="jaune" text="freeIgor.jaune.0"/>
  		<moveTo who="jaune" pos="0,16" speed="1.5" delta="true"/>
  		<actions>
  		    <moveTo who="igor" foreground="true" pos="96,41" unstoppable="true"/>
        	<moveTo who="jaune" pos="190,83"/>
  		</actions>
  		<angle who="igor" value="2"/>
        <actions>
			<activate what="igordoor1" value="true"/>
	    	<activate what="igordoor2" value="true"/>
	    </actions>
	    <moveTo who="jaune" pos="104,83"/>
	    <angle who="jaune" value="0"/>
	    <speak who="jaune" text="freeIgor.jaune.1"/>
	    <speak who="igor" text="freeIgor.igor.0"/>
		<speak who="jaune" text="freeIgor.jaune.2"/>
		<moveTo who="jaune" pos="0,-12" speed="1" delta="true"/>
	    <speak who="igor" text="freeIgor.igor.1"/>
	    <wait value="40"/>
		<speak who="jaune" text="freeIgor.jaune.3"/>
	    <speak who="igor" text="freeIgor.igor.2"/>
		<moveTo who="jaune" pos="0,12" delta="true"/>
		<moveTo who="jaune" pos="190,83"/>
		<angle who="jaune" value="3"/>
		<wait value="20"/>
		<actions>
			<activate what="igordoor1" value="false"/>
	    	<activate what="igordoor2" value="false"/>
	    </actions>
	    <wait value="15"/>
		<actions>
			<moveTo who="jaune" pos="223,60"/>
			<moveTo who="igor" pos="6,12" delta="true"/>
		</actions>
		<angle who="igor" value="0"/>
		<moveTo who="igor" pos="0,6" delta="true" foreground="false"/>
		<angle who="jaune" value="2"/>
		<angle who="igor" value="0"/>
		<moveTo who="zildo" pos="0,10" delta="true"/>
		<angle who="zildo" value="2"/>
		<if expQuest="igor_promise_sword">
			<speak who="zildo" text="freeIgor.zildo.0"/>
			<sound name="ZildoAccomplishQuest"/>
			<speak who="igor" text="freeIgor.igor.3"/>
		</if>		
		<if expQuest="!igor_promise_sword">
		    <!-- First time hero meets Igor, so let them introduce themselves, and talk about sword enhancement -->
			<speak who="zildo" text="freeIgor.zildo.firstMeet.0"/>
			<speak who="igor" text="freeIgor.igor.firstMeet.0"/>
			<actions>
				<speak who="igor" text="freeIgor.igor.firstMeet.1"/>
				<sound name="ZildoAccomplishQuest"/>
			</actions>
			<speak who="zildo" text="freeIgor.zildo.firstMeet.1"/>
			<speak who="igor" text="freeIgor.igor.firstMeet.2"/>
			<markQuest name="igor_promise_sword" value="true"/>
		</if>
		<script who="igor" value="16" effect="zildo"/>
	</scene>
	
	<scene id="meetingLibrary">
	    <wait value="60"/>
	    <speak who="hector" text="d4m2.hector.0"/>
	    <angle who="maltus" value="2"/>
	    <actions>
	        <moveTo who="zildo" delta="true" pos="0,-32" speed="1"/>
		    <speak who="zildo" text="d4m2.zildo.0"/>
	    </actions>
	    <speak who="hector" text="d4m2.hector.1"/>
	    <speak who="hector" text="d4m2.hector.2"/>
	    
	    <if expQuest="igor_promise_sword">
		    <speak who="zildo" text="d4m2.zildo.1"/>
		    <speak who="hector" text="d4m2.hector.3"/>
		    <speak who="zildo" text="d4m2.zildo.2"/>
		    <speak who="hector" text="d4m2.hector.4"/>
		    <angle who="anselme" value="1"/>
		    <speak who="anselme" text="d4m2.anselme.0"/>

		   	<if expQuest="freedIgor">
	  		    <speak who="zildo" text="d4m2.zildo.3"/>
			    <speak who="hector" text="d4m2.hector.5"/>
			    <speak who="hector" text="d4m2.hector.6"/>
			    
			    <moveTo who="hector" pos="217,60"/>
			    <angle who="maltus" value="3"/>
			    <angle who="hector" value="3"/>
			    <moveTo who="zildo" pos="-64,0" delta="true" speed="0.7"/>
			    <actions>
				    <moveTo who="hector" pos="87,60"/>
				    <moveTo who="zildo" pos="130,81"/>
			    </actions>
   			    <moveTo who="hector" pos="0,-4" delta="true"/>
			    <angle who="zildo" value="3"/>
			    <wait value="40"/>
			    <moveTo who="hector" pos="0,4" delta="true" backward="true" unblock="true"/>
	    		<activate what="hiddendoor" value="true"/>
	    		<sound name="ZildoSecret"/>
	    		<wait value="40"/>
	    		<actions>
	    			<moveTo who="hector" pos="8,61"/>
	    		    <moveTo who="zildo" pos="32,61"/>
	    		</actions>
	    		<actions>
	    			<moveTo who="hector" pos="-10,0" delta="true" unstoppable="true"/>
	    		    <moveTo who="zildo" pos="-38,0" delta="true" unstoppable="true"/>
	    		</actions>
	    		<exec script="zildoHectorCave"/>
			</if>
			<if expQuest="!freedIgor">
	  		    <speak who="zildo" text="d4m2.zildo.4"/>
	  		    <speak who="hector" text="d4m2.hector.7"/>
	  		    <speak who="anselme" text="d4m2.anselme.1"/>
	  		    <if expQuest="!beenFishermanVillage">
	  		    	<speak who="zildo" text="d4m2.zildo.5"/>
	  		    	<speak who="anselme" text="d4m2.anselme.2"/>
	  		    </if>
  		    	<speak who="zildo" text="d4m2.zildo.6"/>
   			</if>
	    </if>
	    <if expQuest="!igor_promise_sword">
		    <speak who="zildo" text="d4m2.zildo.7"/>
			<speak who="hector" text="d4m2.hector.8"/>
		    <speak who="zildo" text="d4m2.zildo.8"/>
	    </if>
	    	    
	</scene>
	
	<scene id="zildoHectorCave">
	    <!-- Hero and Hector are in d4m2b -->
	    <moveTo who="hector" pos="-50,0" delta="true" unstoppable="true"/>
	    <moveTo who="zildo" pos="-10,0" delta="true"/>
	    <moveTo who="hector" pos="0,8" delta="true"/>
	    <actions>
	    	<moveTo who="hector" pos="246,80"/>
	        <moveTo who="zildo" pos="260,60"/>
	    </actions>
   	    <actions>
	        <moveTo who="hector" pos="247,103"/>
	        <moveTo who="zildo" pos="247,89"/>
	    </actions>
	    <actions>
	        <moveTo who="hector" pos="260,104" unstoppable="true"/>
	        <moveTo who="zildo" pos="244,101" speed="0.5"/>
	    </actions>
	    <moveTo who="hector" pos="267,108" speed="0.3" unblock="true"/>
	    <sound name="ZildoDescend"/>
	    <wait value="10"/>
	    <fadeOut type="2"/>
	    <map name="lugduniag"/>
	    <remove chaining="d4m2b"/>
	    <pos who="hector" pos="152,122" angle="0"/>
	    <pos who="zildo" pos="151,84"/>
	    <sound name="ZildoDescend"/>
	    <fadeIn type="2" unblock="true"/>
	    <moveTo who="zildo" pos="151,100" speed="0.5"/>
	    <speak who="hector" text="lugduniag.hector.0"/>
	    <!-- follow through the cave -->
	    <moveTo who="hector" pos="170,121"/>
	    <script who="zildo" value="16" effect="hector"/>
	    <speak who="hector" text="lugduniag.hector.1" unblock="true"/>
	    <moveTo who="hector" pos="301,232"/>
	    <speak who="hector" text="lugduniag.hector.2" unblock="true"/>
	    <moveTo who="hector" pos="305,326" open="true"/>
   	    <moveTo who="hector" pos="455,366"/>
	    <speak who="hector" text="lugduniag.hector.3" unblock="true"/>
   	    <moveTo who="hector" pos="577,547"/>
	    <moveTo who="hector" pos="773,554"/>
	    <moveTo who="hector" pos="777,754"/>
	    <moveTo who="hector" pos="928,754"/>
	    <speak who="hector" text="lugduniag.hector.4"/>
	    <moveTo who="hector" pos="928,664" open="true" unblock="true"/>
  	    <speak who="hector" text="lugduniag.hector.5"/>
  	    <angle who="hector" value="2"/>
	    <speak who="hector" text="lugduniag.hector.6"/>
	    <script who="zildo" value="3"/>
	    <moveTo who="zildo" pos="0,4" delta="true" unstoppable="true"/>
	    <angle who="zildo" value="0"/>
	    <moveTo who="hector" pos="917,664"/>
	    <angle who="hector" value="1"/>
	    <!-- Note that hero must catch Igor -->
	    <markQuest name="waitingForIgor" value="true"/>
	</scene>
	
	<scene id="liberationIgor">
	    <music name=""/>
		<script who="igor" value="3"/>
	    <moveTo who="igor" unstoppable="true" pos="744,230"/>
	    <wait value="40"/>
	    <speak who="zildo" text="prisonext.freeIgor.zildo.0"/>
	    <angle who="igor" value="0"/>
	    <speak who="igor" text="prisonext.freeIgor.igor.1"/>
	    <actions>
	        <moveTo who="zildo" pos="720,231"/>
			<speak who="zildo" text="prisonext.freeIgor.zildo.1"/>
	    </actions>
	    <angle who="zildo" value="1"/>
	    <angle who="igor" value="3"/>
		<speak who="zildo" text="prisonext.freeIgor.zildo.2"/>
		<speak who="igor" text="prisonext.freeIgor.igor.2"/>
		<speak who="zildo" text="prisonext.freeIgor.zildo.3"/>
		<moveTo who="igor" pos="714,240" unstoppable="true"/>
		<moveTo who="igor" pos="670,228" unstoppable="true"/>
		<angle who="igor" value="1"/>
		<angle who="zildo" value="3"/>
		<speak who="igor" text="prisonext.freeIgor.igor.3"/>
		<speak who="zildo" text="prisonext.freeIgor.zildo.4"/>
		<music name="Chateau"/>
	</scene>

	<scene id="meetIgor">
	    <moveTo who="igor" pos="0,4" delta="true"/>
	    <script who="igor" value="2" effect="zildo"/>
	    <speak who="igor" text="pext.rescue.igor.0"/>
		<speak who="zildo" text="pext.rescue.zildo.0"/>
		<speak who="igor" text="pext.rescue.igor.1"/>
		<focus/>
		<script who="igor" value="16" effect="zildo"/>
		<moveTo who="zildo" pos="913,471" speed="0.8" unblock="true"/>
		<wait value="150"/>
		<fadeOut value="0"/>
		<wait value="50"/>
		<exec script="ep2_closure"/>
	</scene>
	
	<scene id="ep2_closure">
	   <speak what="camera" text="ep2.ending.0"/>
	   <speak what="camera" text="ep2.ending.1"/>
	   <music name="Chateau"/>
	   <map name="d4m9"/>
	   <spawn who="igor" type="IGOR" pos="71,119" angle="0"/>
	   <fadeIn value="0"/>
	   <wait value="60"/>
	   <moveTo who="igor" pos="120,127"/>
	   <wait value="20"/>
	   <moveTo who="igor" pos="71,119"/>
	   <angle who="igor" value="0"/>
	   <speak what="camera" text="ep2.ending.2"/>
	   <speak what="camera" text="ep2.ending.3"/>
	   <fadeOut value="0"/>
	   <speak what="camera" text="ep2.ending.4"/>
	   <music/>
	   <!-- 
	   <exec script="ep2_realClosure"/>
	   -->
	   <exec script="intro_episode3"/>
	</scene>
	
	<scene id="ep2_realClosure">
	   <speak what="camera" text="ep2.ending.cut.0"/>
	   <music name="Voleurs"/>
	   <speak what="camera" text="ep2.ending.cut.1"/>
	   <end type="0"/>
	</scene>
	
	<persoAction id="sleeping">
	    <timer each="40+20*random">
	        <action>
		        <spawn type="dice10>4:ZZZ1,ZZZ2"
		               pos="x, y" z="4"
		               vx="0.1" vz="0.1"
		               foreground="true"
		               alphaA="-0.1"/>
	        </action>
	    </timer>
	</persoAction>
	
	<persoAction id="hiddenHector">
	    <timer each="20+60*random">
	        <action>
		        <pos who="hector" pos="2,0" delta="true"/>
	            <wait value="10"/>
	            <pos who="hector" pos="-2,0" delta="true"/>
	            <wait value="30"/>
		        <pos who="hector" pos="1,0" delta="true"/>
	            <wait value="5"/>
	            <pos who="hector" pos="-1,0" delta="true"/>
	        </action>
	    </timer>
	</persoAction>
	
	<tileAction id="illTree">
	    <tile pos="x,y" fore="1735"/> <tile pos="x+1,y" fore="1736"/>
   	    <tile pos="x+2,y" fore="1737"/> <tile pos="x+3,y" fore="1738"/>
	    <tile pos="x,y+1" fore="1739"/> <tile pos="x+1,y+1" fore="1740"/>
   	    <tile pos="x+2,y+1" fore="1741"/> <tile pos="x+3,y+1" fore="1742"/>
	    <tile pos="x,y+2" fore="1743"/> <tile pos="x+1,y+2" fore="1744"/>
   	    <tile pos="x+2,y+2" fore="1745"/> <tile pos="x+3,y+2"  fore="1746"/>
	    <tile pos="x,y+3" back="1747"/> <tile pos="x+1,y+3" back="1748"/>
   	    <tile pos="x+2,y+3" back="1749"/> <tile pos="x+3,y+3" back="1750"/>
   	    <timer each="30+600*random">
   	        <action>
   	            <spawn type="LEAF"
		               pos="x*16+random*64, y*16+random*16+80" z="48"
		               vx="-0.4+random*0.8" vz="-0.1" az="-0.001"
		               reverse="dice10>5:128,0"
		               fx="0.004"
		               alphaA="-0.0002"/>
   	        </action>
   	    </timer>
   	</tileAction>
</adventure>